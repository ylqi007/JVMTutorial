# Chapter14. 垃圾回收概述

## 14.1 什么是垃圾
* 什么是垃圾(Garbage)呢？
  * 垃圾是指在**运行程序中没有任何指针指向的对象**，这个对象就是需要会回收的垃圾。
  * Eng: An object is considered garbage when it can no longer be reached from any pointer in the running program.
* 如果不及时堆内存中的垃圾进行回收，那么，这些垃圾对象所占的内存空间可能会一直保留到引用程序结束，被保留的空间无法被其他对象使用。甚至可能导致**内存溢出**。


## 14.2 为什么需要GC
1. 对于高级语言来说，一个基本认知是如果不进行垃圾回收，内存迟早会被消耗完，因为不断地分配内存空间而不进行回收，就好像不停地生产生活垃圾而从来不进行打扫。
2. 除了释放没用的对象，垃圾回收也可以清除内存里的记录碎片。碎片整理将所占用的堆内存移到堆的一端，以便JVM将整理出的内存分配给新的对象。
3. 随着应用程序所应付的业务越来越大、复杂，用户越来越多，没有GC就不能保证应用程序的正常运行。而经常造成STW的GC又跟不上实际的需求，所以才会不断地尝试堆GC进行优化。


## 14.3 早期垃圾回收
* 在早期的C/C++时代，垃圾回收基本上是手工进行的。开发人员可以使用`new`关键字进行垃圾回收，并使用`delete`关键字进行内存释放。
* 这种方式可以灵活的控制内存的释放时间，但是会给开发人员带来频繁申请和释放内存的管理负担。倘若有一处内存空间由于程序员编码的问题忘记被回收，那么就会产生严重的**内存泄漏**，垃圾对象永远无法被清除，随着系统运行时间的不断增长，垃圾对象所耗内存可能持续上升，直到出现内存溢出并造成应用程序崩溃。
* 现在，除了Java之外，C#、Python、Ruby等语言都使用了自动垃圾回收的思想，也就是未来发展趋势。可以说，这种自动话的内存分配和垃圾回收的方式已经成为现代开发语言的必备的标准。


## 14.4 Java垃圾回收机制
* 自动内存管理，无需开发人员手动参与内存的分配与回收，这样降低内存泄漏和内存溢出的风险。
  * 没有垃圾回收器，java也会和cpp一样，各种垂悬指针、野指针，泄漏问题
* 自动内存管理机制，将程序员从繁重的内存管理中释放出来，可以更专心地专注于业务开发
* Oracle官网关于垃圾回收的介绍
  * https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/
  * https://docs.oracle.com/en/java/javase/17/gctuning/introduction-garbage-collection-tuning.html

**担忧:**
* 对于Java开发人员而言，自动内存管理就像是一个黑匣子，如果过度依赖于"自动"，那么这将会是异常灾难，最严重的就会弱化Java开发人员在程序出现内存溢出问题时定位和解决问题的能力。
* 此时，了解JVM的自动内存分配和内存回收原理就显得非常重要，只有在真正了解JVM如何管理内存后，我们才能够遇见`OutOfMemoryError`时，快速的根据错误异常日志定位问题和解决问题。
* 当需要排查各种内存溢出、内存泄漏问题时，当垃圾收集成为系统达到更高并发量的瓶颈时，我们就必须对这些"自动化"的技术实施必要的监控和调节。


* 垃圾回收器可以对年轻代回收，也可以对老年代回收，甚至是全堆和方法区的回收。
  * 其中，Java堆是垃圾回收器的工作重点。
* 从次数上讲:
  * 频繁收集Young区
  * 较少收集Old区
  * 基本不懂Perm区(或元空间)
